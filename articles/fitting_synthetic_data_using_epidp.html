<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting synthetic data using epidp • epidp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting synthetic data using epidp">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epidp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fitting_real_covid19_data.html">Fitting real COVID-19 case data</a></li>
    <li><a class="dropdown-item" href="../articles/fitting_synthetic_data_including_covariates.html">Fitting synthetic data including covariates</a></li>
    <li><a class="dropdown-item" href="../articles/fitting_synthetic_data_using_epidp.html">Fitting synthetic data using epidp</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting synthetic data using epidp</h1>
            
      

      <div class="d-none name"><code>fitting_synthetic_data_using_epidp.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ben18785.github.io/epidp/">epidp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:magrittr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     set_names</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tidyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:magrittr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     extract</span></span></code></pre></div>
<p>In this vignette, we show how <code>epidp</code> can be used to
generate then fit to synthetically generated infection data. Throughout,
we assume a generating process of the form:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>t</mi></msub><mo>∼</mo><mtext mathvariant="normal">Poisson</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><msub><mi>Λ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation}
I_t \sim \text{Poisson}(R_t \Lambda_t),
\end{equation}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Λ</mi><mo>:=</mo><msubsup><mo>∑</mo><mrow><mi>s</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msub><mi>ω</mi><mi>s</mi></msub><msub><mi>I</mi><mrow><mi>t</mi><mo>−</mo><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\Lambda:=\sum_{s=1}^t \omega_s I_{t-s}</annotation></semantics></math>.</p>
<div class="section level2">
<h2 id="step-function-in-r_t">Step function in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#step-function-in-r_t"></a>
</h2>
<p>We first generate case data assuming a step function for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rt_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">t</span> <span class="op">&lt;=</span> <span class="fl">60</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">t</span> <span class="op">&lt;=</span> <span class="fl">90</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">R</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">R</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># simulation parameters</span></span>
<span><span class="va">nt</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">mean_si</span> <span class="op">&lt;-</span> <span class="fl">6.5</span></span>
<span><span class="va">sd_si</span> <span class="op">&lt;-</span> <span class="fl">4.03</span></span>
<span><span class="va">i_0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># data frame of outputs</span></span>
<span><span class="va">epidemic_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_renewal_epidemic.html">simulate_renewal_epidemic</a></span><span class="op">(</span><span class="va">rt_fun</span>, <span class="va">nt</span>, <span class="va">mean_si</span>, <span class="va">sd_si</span>, <span class="va">i_0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">transform_factor</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">epidemic_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">w_dist</span>, <span class="va">lambda_t</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>R_t <span class="op">=</span> <span class="va">R_t</span> <span class="op">*</span> <span class="va">transform_factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i_t</span>, <span class="va">R_t</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Incidence (i_t)"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">/</span> <span class="va">transform_factor</span>, name <span class="op">=</span> <span class="st">"Reproduction Number (R_t)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span><span class="st">"Series"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_synthetic_data_using_epidp_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>We now use a Stan version of EpiFilter to estimate the maximum a
posteriori estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
and overlay these on top of the actual values. Note, these estimates do
not have uncertainty associated with them but the benefit of this is
that estimation is instantaneous. The estimates are close to the actual
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
values after an initial period when case counts are low.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_epifilter.html">fit_epifilter</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">epidemic_df</span><span class="op">$</span><span class="va">i_t</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="va">epidemic_df</span><span class="op">$</span><span class="va">i_t</span>,</span>
<span>  w <span class="op">=</span> <span class="va">epidemic_df</span><span class="op">$</span><span class="va">w_dist</span>,</span>
<span>  is_sampling <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  as_vector <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">par</span><span class="op">$</span><span class="va">R</span></span>
<span><span class="va">epidemic_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>estimated <span class="op">=</span> <span class="va">R</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>true <span class="op">=</span> <span class="va">R_t</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">estimated</span>, <span class="va">true</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">estimated</span>, <span class="va">true</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span><span class="st">"R_t"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"R_t"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_synthetic_data_using_epidp_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="sinusoidal-function-in-r_t">Sinusoidal function in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#sinusoidal-function-in-r_t"></a>
</h2>
<p>We now generate case data assuming a sinusoidal
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define sinusoidal Rt</span></span>
<span><span class="va">rt_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">1.3</span> <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="va">pi</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">nt</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">mean_si</span> <span class="op">&lt;-</span> <span class="fl">6.5</span></span>
<span><span class="va">sd_si</span> <span class="op">&lt;-</span> <span class="fl">4.03</span></span>
<span><span class="va">i_0</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># data frame of outputs</span></span>
<span><span class="va">epidemic_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_renewal_epidemic.html">simulate_renewal_epidemic</a></span><span class="op">(</span><span class="va">rt_fun</span>, <span class="va">nt</span>, <span class="va">mean_si</span>, <span class="va">sd_si</span>, <span class="va">i_0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">transform_factor</span> <span class="op">&lt;-</span> <span class="fl">150</span></span>
<span><span class="va">epidemic_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">w_dist</span>, <span class="va">lambda_t</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>R_t <span class="op">=</span> <span class="va">R_t</span> <span class="op">*</span> <span class="va">transform_factor</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">i_t</span>, <span class="va">R_t</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"Incidence (i_t)"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">/</span> <span class="va">transform_factor</span>, name <span class="op">=</span> <span class="st">"Reproduction Number (R_t)"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span><span class="st">"Series"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_synthetic_data_using_epidp_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We now use a Stan version of EpiFilter to estimate the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
profile.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_epifilter.html">fit_epifilter</a></span><span class="op">(</span></span>
<span>  N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">epidemic_df</span><span class="op">$</span><span class="va">i_t</span><span class="op">)</span>,</span>
<span>  C <span class="op">=</span> <span class="va">epidemic_df</span><span class="op">$</span><span class="va">i_t</span>,</span>
<span>  w <span class="op">=</span> <span class="va">epidemic_df</span><span class="op">$</span><span class="va">w_dist</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  chains <span class="op">=</span> <span class="fl">1</span> <span class="co"># to pass CRAN</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'epifilter' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.001416 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 14.16 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: WARNING: There aren't enough warmup iterations to fit the</span></span>
<span><span class="co">#&gt; Chain 1:          three stages of adaptation as currently configured.</span></span>
<span><span class="co">#&gt; Chain 1:          Reducing each adaptation stage to 15%/75%/10% of</span></span>
<span><span class="co">#&gt; Chain 1:          the given number of warmup iterations:</span></span>
<span><span class="co">#&gt; Chain 1:            init_buffer = 15</span></span>
<span><span class="co">#&gt; Chain 1:            adapt_window = 75</span></span>
<span><span class="co">#&gt; Chain 1:            term_buffer = 10</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:   1 / 200 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  20 / 200 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  40 / 200 [ 20%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  60 / 200 [ 30%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  80 / 200 [ 40%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 100 / 200 [ 50%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 101 / 200 [ 50%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 120 / 200 [ 60%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 140 / 200 [ 70%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 160 / 200 [ 80%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 180 / 200 [ 90%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 200 / 200 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 10.613 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                10.894 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                21.507 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning in validityMethod(object): The following variables have undefined</span></span>
<span><span class="co">#&gt; values: log_likelihood[1]. Many subsequent functions will not work correctly.</span></span>
<span><span class="co">#&gt; Warning: The largest R-hat is NA, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span>
<span><span class="co">#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#bulk-ess</span></span>
<span><span class="co">#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#tail-ess</span></span>
<span></span>
<span><span class="co"># look at MCMC summaries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Inference for Stan model: epifilter.</span></span>
<span><span class="co">#&gt; 1 chains, each with iter=200; warmup=100; thin=1; </span></span>
<span><span class="co">#&gt; post-warmup draws per chain=100, total post-warmup draws=100.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        mean se_mean   sd 2.5%  25%  50%  75% 97.5% n_eff Rhat</span></span>
<span><span class="co">#&gt; sigma  0.14    0.00 0.01 0.12 0.13 0.14 0.14  0.16    32 0.99</span></span>
<span><span class="co">#&gt; R[1]   1.58    0.05 0.46 0.70 1.31 1.55 1.82  2.51    76 0.99</span></span>
<span><span class="co">#&gt; R[2]   1.57    0.05 0.40 0.83 1.28 1.54 1.82  2.50    69 0.99</span></span>
<span><span class="co">#&gt; R[3]   1.58    0.05 0.38 0.83 1.35 1.56 1.77  2.45    61 0.99</span></span>
<span><span class="co">#&gt; R[4]   1.54    0.05 0.34 0.90 1.31 1.51 1.73  2.20    55 0.99</span></span>
<span><span class="co">#&gt; R[5]   1.53    0.04 0.33 0.90 1.32 1.50 1.76  2.15    56 0.99</span></span>
<span><span class="co">#&gt; R[6]   1.60    0.04 0.33 1.02 1.37 1.60 1.85  2.22    56 1.00</span></span>
<span><span class="co">#&gt; R[7]   1.67    0.04 0.33 1.05 1.41 1.65 1.89  2.34    63 0.99</span></span>
<span><span class="co">#&gt; R[8]   1.71    0.04 0.36 1.02 1.42 1.73 1.96  2.46    90 1.00</span></span>
<span><span class="co">#&gt; R[9]   1.77    0.04 0.36 1.16 1.51 1.75 2.05  2.55   106 0.99</span></span>
<span><span class="co">#&gt; R[10]  1.86    0.03 0.33 1.27 1.64 1.85 2.07  2.48   120 0.99</span></span>
<span><span class="co">#&gt; R[11]  1.91    0.03 0.34 1.34 1.62 1.92 2.09  2.62   103 0.99</span></span>
<span><span class="co">#&gt; R[12]  1.93    0.03 0.32 1.39 1.72 1.88 2.13  2.51   114 0.99</span></span>
<span><span class="co">#&gt; R[13]  1.97    0.03 0.29 1.51 1.75 1.95 2.13  2.55   131 0.99</span></span>
<span><span class="co">#&gt; R[14]  2.03    0.02 0.30 1.52 1.82 2.02 2.23  2.60   172 0.99</span></span>
<span><span class="co">#&gt; R[15]  2.07    0.02 0.31 1.42 1.91 2.04 2.29  2.63   168 1.00</span></span>
<span><span class="co">#&gt; R[16]  2.11    0.03 0.31 1.49 1.92 2.08 2.31  2.76   111 0.99</span></span>
<span><span class="co">#&gt; R[17]  2.16    0.03 0.29 1.56 1.98 2.14 2.34  2.77    89 1.00</span></span>
<span><span class="co">#&gt; R[18]  2.25    0.03 0.28 1.71 2.08 2.22 2.42  2.76   104 0.99</span></span>
<span><span class="co">#&gt; R[19]  2.33    0.02 0.27 1.87 2.16 2.29 2.52  2.85   160 1.00</span></span>
<span><span class="co">#&gt; R[20]  2.40    0.02 0.26 1.94 2.24 2.40 2.55  2.84   113 1.00</span></span>
<span><span class="co">#&gt; R[21]  2.49    0.03 0.25 2.04 2.31 2.49 2.64  3.02    92 0.99</span></span>
<span><span class="co">#&gt; R[22]  2.61    0.02 0.26 2.15 2.42 2.59 2.80  3.11   148 1.00</span></span>
<span><span class="co">#&gt; R[23]  2.63    0.03 0.27 2.21 2.40 2.62 2.86  3.09   103 1.00</span></span>
<span><span class="co">#&gt; R[24]  2.63    0.02 0.27 2.09 2.45 2.61 2.76  3.20   123 1.00</span></span>
<span><span class="co">#&gt; R[25]  2.55    0.02 0.25 2.06 2.38 2.55 2.70  3.07   109 1.03</span></span>
<span><span class="co">#&gt; R[26]  2.53    0.02 0.21 2.15 2.36 2.53 2.68  2.96    96 1.02</span></span>
<span><span class="co">#&gt; R[27]  2.61    0.02 0.20 2.22 2.45 2.61 2.74  2.94   103 0.99</span></span>
<span><span class="co">#&gt; R[28]  2.44    0.02 0.19 2.09 2.31 2.44 2.57  2.83   114 0.99</span></span>
<span><span class="co">#&gt; R[29]  2.28    0.02 0.20 1.93 2.16 2.27 2.41  2.61   107 0.99</span></span>
<span><span class="co">#&gt; R[30]  2.20    0.02 0.17 1.88 2.08 2.21 2.30  2.55    92 1.03</span></span>
<span><span class="co">#&gt; R[31]  2.19    0.02 0.17 1.91 2.08 2.19 2.29  2.52   110 0.99</span></span>
<span><span class="co">#&gt; R[32]  2.13    0.01 0.17 1.85 2.02 2.13 2.23  2.50   129 0.99</span></span>
<span><span class="co">#&gt; R[33]  2.20    0.01 0.17 1.92 2.09 2.19 2.29  2.61   136 0.99</span></span>
<span><span class="co">#&gt; R[34]  2.10    0.02 0.15 1.82 1.98 2.09 2.23  2.35    88 0.99</span></span>
<span><span class="co">#&gt; R[35]  1.92    0.01 0.15 1.64 1.83 1.92 2.03  2.21   111 0.99</span></span>
<span><span class="co">#&gt; R[36]  1.87    0.02 0.14 1.61 1.76 1.85 1.96  2.13    84 1.00</span></span>
<span><span class="co">#&gt; R[37]  1.82    0.01 0.14 1.56 1.74 1.81 1.92  2.09   103 1.02</span></span>
<span><span class="co">#&gt; R[38]  1.84    0.01 0.12 1.65 1.76 1.83 1.95  2.04    93 1.00</span></span>
<span><span class="co">#&gt; R[39]  1.75    0.01 0.12 1.56 1.67 1.75 1.84  2.00    80 0.99</span></span>
<span><span class="co">#&gt; R[40]  1.59    0.01 0.09 1.44 1.51 1.58 1.65  1.78   118 0.99</span></span>
<span><span class="co">#&gt; R[41]  1.60    0.01 0.10 1.43 1.52 1.61 1.68  1.77    98 1.02</span></span>
<span><span class="co">#&gt; R[42]  1.51    0.01 0.10 1.33 1.43 1.49 1.59  1.68   128 0.99</span></span>
<span><span class="co">#&gt; R[43]  1.35    0.01 0.10 1.17 1.27 1.33 1.40  1.56    86 0.99</span></span>
<span><span class="co">#&gt; R[44]  1.48    0.01 0.10 1.29 1.42 1.48 1.53  1.70   103 0.99</span></span>
<span><span class="co">#&gt; R[45]  1.35    0.01 0.09 1.20 1.29 1.35 1.42  1.52   129 0.99</span></span>
<span><span class="co">#&gt; R[46]  1.37    0.01 0.10 1.19 1.31 1.37 1.43  1.57   184 0.99</span></span>
<span><span class="co">#&gt; R[47]  1.31    0.01 0.08 1.14 1.26 1.30 1.35  1.46    80 0.99</span></span>
<span><span class="co">#&gt; R[48]  1.14    0.01 0.08 0.98 1.09 1.14 1.18  1.31    93 0.99</span></span>
<span><span class="co">#&gt; R[49]  1.03    0.01 0.08 0.89 0.99 1.02 1.09  1.18    84 0.99</span></span>
<span><span class="co">#&gt; R[50]  0.89    0.01 0.07 0.74 0.84 0.88 0.94  1.01   109 0.99</span></span>
<span><span class="co">#&gt; R[51]  0.81    0.01 0.06 0.70 0.76 0.80 0.84  0.94   133 0.99</span></span>
<span><span class="co">#&gt; R[52]  0.78    0.01 0.06 0.65 0.74 0.78 0.82  0.88    94 1.00</span></span>
<span><span class="co">#&gt; R[53]  0.61    0.01 0.06 0.52 0.58 0.61 0.64  0.72    48 0.99</span></span>
<span><span class="co">#&gt; R[54]  0.60    0.00 0.06 0.49 0.56 0.61 0.64  0.71   151 1.02</span></span>
<span><span class="co">#&gt; R[55]  0.56    0.01 0.05 0.46 0.53 0.57 0.60  0.66    68 1.02</span></span>
<span><span class="co">#&gt; R[56]  0.46    0.01 0.05 0.36 0.43 0.45 0.49  0.55    91 1.00</span></span>
<span><span class="co">#&gt; R[57]  0.41    0.00 0.04 0.33 0.38 0.41 0.44  0.49   113 0.99</span></span>
<span><span class="co">#&gt; R[58]  0.34    0.00 0.04 0.27 0.31 0.34 0.37  0.41   103 1.00</span></span>
<span><span class="co">#&gt; R[59]  0.24    0.00 0.04 0.16 0.21 0.24 0.26  0.31   152 0.99</span></span>
<span><span class="co">#&gt; R[60]  0.22    0.00 0.03 0.16 0.19 0.22 0.23  0.29   176 1.01</span></span>
<span><span class="co">#&gt; R[61]  0.18    0.00 0.03 0.12 0.16 0.18 0.20  0.25   122 0.99</span></span>
<span><span class="co">#&gt; R[62]  0.18    0.00 0.04 0.12 0.15 0.17 0.20  0.24   126 0.99</span></span>
<span><span class="co">#&gt; R[63]  0.17    0.00 0.04 0.11 0.14 0.17 0.19  0.25   144 0.99</span></span>
<span><span class="co">#&gt; R[64]  0.12    0.00 0.03 0.07 0.10 0.12 0.14  0.20   109 0.99</span></span>
<span><span class="co">#&gt; R[65]  0.12    0.00 0.04 0.07 0.09 0.12 0.15  0.20   167 1.01</span></span>
<span><span class="co">#&gt; R[66]  0.09    0.00 0.03 0.04 0.07 0.09 0.12  0.15    83 1.05</span></span>
<span><span class="co">#&gt; R[67]  0.10    0.00 0.04 0.03 0.07 0.08 0.12  0.18    98 1.01</span></span>
<span><span class="co">#&gt; R[68]  0.13    0.00 0.05 0.05 0.09 0.12 0.15  0.23   100 1.03</span></span>
<span><span class="co">#&gt; R[69]  0.15    0.01 0.06 0.06 0.11 0.14 0.17  0.29   119 0.99</span></span>
<span><span class="co">#&gt; R[70]  0.17    0.01 0.06 0.07 0.12 0.15 0.20  0.31    84 0.99</span></span>
<span><span class="co">#&gt; R[71]  0.19    0.01 0.07 0.10 0.14 0.19 0.24  0.32    77 0.99</span></span>
<span><span class="co">#&gt; R[72]  0.24    0.01 0.08 0.11 0.18 0.23 0.31  0.42    82 0.99</span></span>
<span><span class="co">#&gt; R[73]  0.26    0.01 0.08 0.10 0.20 0.25 0.31  0.42    70 0.99</span></span>
<span><span class="co">#&gt; R[74]  0.28    0.01 0.10 0.10 0.21 0.28 0.35  0.50    55 0.99</span></span>
<span><span class="co">#&gt; R[75]  0.32    0.01 0.12 0.12 0.24 0.30 0.39  0.56    69 0.99</span></span>
<span><span class="co">#&gt; R[76]  0.36    0.01 0.12 0.18 0.28 0.34 0.43  0.62    72 0.99</span></span>
<span><span class="co">#&gt; R[77]  0.46    0.02 0.14 0.24 0.38 0.44 0.54  0.80    64 0.99</span></span>
<span><span class="co">#&gt; R[78]  0.54    0.02 0.17 0.31 0.45 0.50 0.63  0.96    78 0.99</span></span>
<span><span class="co">#&gt; R[79]  0.61    0.02 0.16 0.35 0.49 0.59 0.70  0.97    83 0.99</span></span>
<span><span class="co">#&gt; R[80]  0.66    0.02 0.18 0.38 0.55 0.65 0.75  1.10    69 0.99</span></span>
<span><span class="co">#&gt; R[81]  0.74    0.02 0.18 0.39 0.65 0.74 0.83  1.12    85 0.99</span></span>
<span><span class="co">#&gt; R[82]  0.84    0.02 0.23 0.44 0.71 0.81 0.95  1.34    84 0.99</span></span>
<span><span class="co">#&gt; R[83]  0.96    0.03 0.23 0.53 0.79 0.92 1.12  1.43    67 0.99</span></span>
<span><span class="co">#&gt; R[84]  1.02    0.03 0.24 0.57 0.86 1.03 1.19  1.53    75 0.99</span></span>
<span><span class="co">#&gt; R[85]  1.13    0.03 0.26 0.61 0.98 1.13 1.27  1.65    80 0.99</span></span>
<span><span class="co">#&gt; R[86]  1.22    0.03 0.29 0.67 1.03 1.22 1.40  1.85    79 1.00</span></span>
<span><span class="co">#&gt; R[87]  1.33    0.03 0.26 0.77 1.15 1.30 1.51  1.88    82 0.99</span></span>
<span><span class="co">#&gt; R[88]  1.41    0.03 0.25 0.91 1.25 1.43 1.58  1.93    71 0.99</span></span>
<span><span class="co">#&gt; R[89]  1.44    0.03 0.26 0.94 1.23 1.43 1.63  1.89    91 0.99</span></span>
<span><span class="co">#&gt; R[90]  1.49    0.02 0.25 1.06 1.32 1.46 1.68  1.97   103 0.99</span></span>
<span><span class="co">#&gt; R[91]  1.50    0.03 0.25 0.98 1.32 1.49 1.67  1.93    76 1.00</span></span>
<span><span class="co">#&gt; R[92]  1.49    0.04 0.25 1.07 1.31 1.49 1.62  1.99    48 0.99</span></span>
<span><span class="co">#&gt; R[93]  1.52    0.02 0.25 1.09 1.37 1.49 1.69  2.07   105 0.99</span></span>
<span><span class="co">#&gt; R[94]  1.55    0.02 0.26 1.13 1.37 1.54 1.70  2.09   141 1.00</span></span>
<span><span class="co">#&gt; R[95]  1.62    0.02 0.25 1.18 1.45 1.62 1.75  2.17   122 1.00</span></span>
<span><span class="co">#&gt; R[96]  1.68    0.02 0.24 1.27 1.51 1.68 1.82  2.22   130 0.99</span></span>
<span><span class="co">#&gt; R[97]  1.79    0.02 0.20 1.43 1.67 1.79 1.93  2.25   121 1.00</span></span>
<span><span class="co">#&gt; R[98]  1.86    0.02 0.22 1.48 1.72 1.84 1.98  2.34   131 0.99</span></span>
<span><span class="co">#&gt; R[99]  1.92    0.02 0.26 1.48 1.74 1.90 2.11  2.41   187 0.99</span></span>
<span><span class="co">#&gt; R[100] 1.96    0.02 0.24 1.49 1.79 1.98 2.11  2.41   153 1.00</span></span>
<span><span class="co">#&gt; R[101] 2.04    0.02 0.24 1.63 1.88 2.04 2.19  2.49   200 0.99</span></span>
<span><span class="co">#&gt; R[102] 2.13    0.02 0.26 1.66 1.95 2.14 2.30  2.61   159 0.99</span></span>
<span><span class="co">#&gt; R[103] 2.19    0.02 0.28 1.69 2.00 2.18 2.37  2.77   168 0.99</span></span>
<span><span class="co">#&gt; R[104] 2.27    0.02 0.26 1.84 2.06 2.22 2.46  2.76   118 1.01</span></span>
<span><span class="co">#&gt; R[105] 2.22    0.03 0.25 1.73 2.03 2.23 2.41  2.72    84 1.00</span></span>
<span><span class="co">#&gt; R[106] 2.20    0.02 0.23 1.75 2.04 2.20 2.41  2.59   102 1.00</span></span>
<span><span class="co">#&gt; R[107] 2.25    0.03 0.24 1.82 2.09 2.23 2.40  2.67    83 1.00</span></span>
<span><span class="co">#&gt; R[108] 2.40    0.02 0.22 2.02 2.23 2.40 2.57  2.82   113 0.99</span></span>
<span><span class="co">#&gt; R[109] 2.56    0.02 0.20 2.19 2.42 2.57 2.69  2.99   103 1.02</span></span>
<span><span class="co">#&gt; R[110] 2.57    0.02 0.20 2.27 2.43 2.55 2.70  3.04    99 0.99</span></span>
<span><span class="co">#&gt; R[111] 2.62    0.02 0.20 2.16 2.48 2.63 2.73  2.99   111 0.99</span></span>
<span><span class="co">#&gt; R[112] 2.41    0.01 0.18 2.08 2.27 2.44 2.52  2.76   161 0.99</span></span>
<span><span class="co">#&gt; R[113] 2.43    0.02 0.20 2.03 2.30 2.41 2.55  2.82   114 1.00</span></span>
<span><span class="co">#&gt; R[114] 2.52    0.02 0.18 2.24 2.37 2.52 2.68  2.84   100 0.99</span></span>
<span><span class="co">#&gt; R[115] 2.54    0.02 0.18 2.18 2.42 2.53 2.69  2.89   112 0.99</span></span>
<span><span class="co">#&gt; R[116] 2.52    0.02 0.17 2.21 2.40 2.51 2.64  2.82   125 0.99</span></span>
<span><span class="co">#&gt; R[117] 2.33    0.02 0.17 2.04 2.20 2.33 2.43  2.63   112 0.99</span></span>
<span><span class="co">#&gt; R[118] 2.43    0.02 0.14 2.15 2.36 2.45 2.52  2.66    88 1.00</span></span>
<span><span class="co">#&gt; R[119] 2.47    0.02 0.15 2.21 2.37 2.45 2.56  2.83    90 1.02</span></span>
<span><span class="co">#&gt; R[120] 2.33    0.01 0.11 2.11 2.27 2.33 2.39  2.55   101 1.04</span></span>
<span><span class="co">#&gt; R[121] 2.20    0.01 0.12 1.98 2.13 2.20 2.30  2.40    72 1.00</span></span>
<span><span class="co">#&gt; R[122] 2.21    0.02 0.11 2.02 2.14 2.20 2.28  2.47    45 1.03</span></span>
<span><span class="co">#&gt; R[123] 2.12    0.01 0.11 1.93 2.03 2.12 2.19  2.32    93 0.99</span></span>
<span><span class="co">#&gt; R[124] 2.08    0.01 0.10 1.91 2.01 2.07 2.14  2.30    67 0.99</span></span>
<span><span class="co">#&gt; R[125] 2.01    0.01 0.10 1.83 1.94 2.00 2.08  2.19   112 0.99</span></span>
<span><span class="co">#&gt; R[126] 1.90    0.01 0.08 1.76 1.84 1.90 1.96  2.03    76 0.99</span></span>
<span><span class="co">#&gt; R[127] 1.94    0.01 0.08 1.82 1.87 1.93 1.98  2.11    79 0.99</span></span>
<span><span class="co">#&gt; R[128] 1.88    0.01 0.08 1.71 1.82 1.88 1.94  2.06    72 1.00</span></span>
<span><span class="co">#&gt; R[129] 1.79    0.01 0.08 1.65 1.73 1.79 1.85  1.95    86 0.99</span></span>
<span><span class="co">#&gt; R[130] 1.75    0.01 0.07 1.59 1.70 1.75 1.80  1.89    86 1.00</span></span>
<span><span class="co">#&gt; R[131] 1.69    0.01 0.06 1.57 1.65 1.69 1.74  1.81    99 0.99</span></span>
<span><span class="co">#&gt; R[132] 1.49    0.01 0.07 1.39 1.44 1.48 1.53  1.62   101 1.00</span></span>
<span><span class="co">#&gt; R[133] 1.45    0.01 0.06 1.34 1.40 1.44 1.49  1.56    82 0.99</span></span>
<span><span class="co">#&gt; R[134] 1.32    0.01 0.06 1.21 1.28 1.33 1.37  1.42   108 0.99</span></span>
<span><span class="co">#&gt; R[135] 1.36    0.01 0.05 1.26 1.34 1.36 1.39  1.45    34 1.06</span></span>
<span><span class="co">#&gt; R[136] 1.30    0.01 0.05 1.19 1.26 1.30 1.35  1.39    81 1.00</span></span>
<span><span class="co">#&gt; R[137] 1.12    0.01 0.04 1.04 1.10 1.13 1.15  1.21    66 1.00</span></span>
<span><span class="co">#&gt; R[138] 1.02    0.00 0.04 0.95 0.99 1.02 1.05  1.11    80 0.99</span></span>
<span><span class="co">#&gt; R[139] 0.93    0.00 0.04 0.86 0.91 0.93 0.96  1.02    94 1.00</span></span>
<span><span class="co">#&gt; R[140] 0.87    0.00 0.04 0.80 0.84 0.86 0.89  0.95    77 0.99</span></span>
<span><span class="co">#&gt; R[141] 0.85    0.00 0.04 0.77 0.82 0.84 0.87  0.92    70 1.00</span></span>
<span><span class="co">#&gt; R[142] 0.80    0.01 0.04 0.72 0.78 0.80 0.82  0.87    59 1.02</span></span>
<span><span class="co">#&gt; R[143] 0.67    0.00 0.04 0.61 0.65 0.67 0.70  0.73   124 1.00</span></span>
<span><span class="co">#&gt; R[144] 0.62    0.00 0.03 0.55 0.60 0.62 0.64  0.68   180 1.01</span></span>
<span><span class="co">#&gt; R[145] 0.48    0.00 0.03 0.43 0.46 0.48 0.50  0.53   153 1.01</span></span>
<span><span class="co">#&gt; R[146] 0.42    0.00 0.03 0.37 0.40 0.42 0.44  0.47    97 0.99</span></span>
<span><span class="co">#&gt; R[147] 0.40    0.00 0.03 0.36 0.38 0.40 0.41  0.47    91 0.99</span></span>
<span><span class="co">#&gt; R[148] 0.37    0.00 0.03 0.31 0.35 0.37 0.39  0.42    82 0.99</span></span>
<span><span class="co">#&gt; R[149] 0.31    0.00 0.03 0.27 0.29 0.31 0.34  0.36   114 0.99</span></span>
<span><span class="co">#&gt; R[150] 0.25    0.00 0.03 0.20 0.24 0.25 0.27  0.30    99 1.03</span></span>
<span><span class="co">#&gt; R[151] 0.20    0.00 0.02 0.16 0.19 0.20 0.22  0.25   110 0.99</span></span>
<span><span class="co">#&gt; R[152] 0.21    0.00 0.03 0.17 0.19 0.20 0.22  0.26   117 1.03</span></span>
<span><span class="co">#&gt; R[153] 0.16    0.00 0.02 0.13 0.15 0.17 0.18  0.20    90 1.04</span></span>
<span><span class="co">#&gt; R[154] 0.13    0.00 0.02 0.10 0.12 0.13 0.15  0.17   146 0.99</span></span>
<span><span class="co">#&gt; R[155] 0.12    0.00 0.02 0.09 0.11 0.12 0.13  0.16   111 0.99</span></span>
<span><span class="co">#&gt; R[156] 0.08    0.00 0.02 0.05 0.07 0.08 0.10  0.12   119 0.99</span></span>
<span><span class="co">#&gt; R[157] 0.09    0.00 0.03 0.04 0.07 0.09 0.11  0.14   176 0.99</span></span>
<span><span class="co">#&gt; R[158] 0.11    0.00 0.03 0.06 0.09 0.11 0.12  0.16   121 1.01</span></span>
<span><span class="co">#&gt; R[159] 0.11    0.00 0.03 0.06 0.09 0.10 0.12  0.17   167 0.99</span></span>
<span><span class="co">#&gt; R[160] 0.10    0.00 0.03 0.05 0.07 0.09 0.12  0.17   115 0.99</span></span>
<span><span class="co">#&gt; R[161] 0.12    0.00 0.04 0.05 0.09 0.11 0.14  0.20   110 0.99</span></span>
<span><span class="co">#&gt; R[162] 0.12    0.00 0.05 0.04 0.08 0.12 0.15  0.21   119 1.00</span></span>
<span><span class="co">#&gt; R[163] 0.16    0.00 0.04 0.08 0.12 0.15 0.18  0.25   140 1.01</span></span>
<span><span class="co">#&gt; R[164] 0.16    0.00 0.05 0.08 0.13 0.16 0.19  0.26    98 1.01</span></span>
<span><span class="co">#&gt; R[165] 0.20    0.01 0.07 0.09 0.15 0.19 0.24  0.36    82 0.99</span></span>
<span><span class="co">#&gt; R[166] 0.22    0.01 0.07 0.10 0.16 0.21 0.26  0.37   106 0.99</span></span>
<span><span class="co">#&gt; R[167] 0.27    0.01 0.09 0.13 0.22 0.27 0.32  0.47   120 0.99</span></span>
<span><span class="co">#&gt; R[168] 0.33    0.01 0.10 0.18 0.25 0.32 0.38  0.56    88 0.99</span></span>
<span><span class="co">#&gt; R[169] 0.43    0.01 0.13 0.22 0.34 0.42 0.51  0.72    85 0.99</span></span>
<span><span class="co">#&gt; R[170] 0.48    0.01 0.14 0.23 0.39 0.45 0.55  0.78    91 1.00</span></span>
<span><span class="co">#&gt; R[171] 0.55    0.02 0.15 0.31 0.44 0.54 0.63  0.86    53 1.03</span></span>
<span><span class="co">#&gt; R[172] 0.64    0.02 0.15 0.33 0.53 0.63 0.73  0.97    45 1.00</span></span>
<span><span class="co">#&gt; R[173] 0.75    0.02 0.16 0.51 0.65 0.73 0.85  1.08    70 0.99</span></span>
<span><span class="co">#&gt; R[174] 0.89    0.02 0.16 0.59 0.78 0.88 1.01  1.21    91 0.99</span></span>
<span><span class="co">#&gt; R[175] 0.97    0.02 0.19 0.63 0.84 0.95 1.07  1.41   107 0.99</span></span>
<span><span class="co">#&gt; R[176] 1.05    0.02 0.19 0.72 0.94 1.02 1.17  1.42   128 1.00</span></span>
<span><span class="co">#&gt; R[177] 1.13    0.02 0.21 0.74 1.00 1.13 1.25  1.55   125 0.99</span></span>
<span><span class="co">#&gt; R[178] 1.18    0.02 0.21 0.88 1.02 1.17 1.31  1.66   111 1.00</span></span>
<span><span class="co">#&gt; R[179] 1.29    0.02 0.23 0.90 1.16 1.25 1.38  1.81   113 0.99</span></span>
<span><span class="co">#&gt; R[180] 1.28    0.02 0.20 0.89 1.14 1.28 1.44  1.59   132 0.99</span></span>
<span><span class="co">#&gt; R[181] 1.33    0.02 0.22 0.95 1.17 1.33 1.47  1.69   114 1.00</span></span>
<span><span class="co">#&gt; R[182] 1.45    0.02 0.25 1.03 1.28 1.44 1.60  1.88   153 1.00</span></span>
<span><span class="co">#&gt; R[183] 1.54    0.02 0.23 1.10 1.39 1.59 1.69  1.97   167 1.00</span></span>
<span><span class="co">#&gt; R[184] 1.67    0.02 0.23 1.27 1.49 1.66 1.86  2.16   142 1.00</span></span>
<span><span class="co">#&gt; R[185] 1.81    0.02 0.24 1.41 1.64 1.80 2.00  2.28   173 0.99</span></span>
<span><span class="co">#&gt; R[186] 1.84    0.02 0.22 1.44 1.66 1.84 1.97  2.28   153 0.99</span></span>
<span><span class="co">#&gt; R[187] 1.88    0.02 0.24 1.42 1.73 1.87 2.04  2.36   166 0.99</span></span>
<span><span class="co">#&gt; R[188] 1.98    0.02 0.23 1.55 1.83 1.98 2.11  2.40   200 1.00</span></span>
<span><span class="co">#&gt; R[189] 2.07    0.02 0.24 1.68 1.92 2.01 2.19  2.59   200 1.00</span></span>
<span><span class="co">#&gt; R[190] 2.01    0.01 0.20 1.66 1.88 1.99 2.12  2.48   195 0.99</span></span>
<span><span class="co">#&gt; R[191] 2.01    0.02 0.24 1.65 1.84 1.97 2.16  2.50   200 0.99</span></span>
<span><span class="co">#&gt; R[192] 2.00    0.02 0.23 1.68 1.84 1.97 2.15  2.53   200 0.99</span></span>
<span><span class="co">#&gt; R[193] 2.10    0.02 0.21 1.73 1.98 2.08 2.24  2.47   200 1.00</span></span>
<span><span class="co">#&gt; R[194] 2.22    0.03 0.21 1.83 2.09 2.22 2.34  2.62    68 1.02</span></span>
<span><span class="co">#&gt; R[195] 2.27    0.02 0.19 1.94 2.15 2.25 2.38  2.74   142 0.99</span></span>
<span><span class="co">#&gt; R[196] 2.36    0.02 0.19 2.03 2.23 2.34 2.47  2.75    90 1.01</span></span>
<span><span class="co">#&gt; R[197] 2.42    0.02 0.18 2.04 2.31 2.41 2.57  2.73    94 1.04</span></span>
<span><span class="co">#&gt; R[198] 2.30    0.02 0.18 1.94 2.17 2.30 2.42  2.68    98 1.01</span></span>
<span><span class="co">#&gt; R[199] 2.32    0.01 0.17 2.04 2.22 2.32 2.42  2.69   150 0.99</span></span>
<span><span class="co">#&gt; R[200] 2.21    0.02 0.20 1.84 2.06 2.21 2.35  2.59    97 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Samples were drawn using NUTS(diag_e) at Thu Nov 14 19:50:14 2024.</span></span>
<span><span class="co">#&gt; For each parameter, n_eff is a crude measure of effective sample size,</span></span>
<span><span class="co">#&gt; and Rhat is the potential scale reduction factor on split chains (at </span></span>
<span><span class="co">#&gt; convergence, Rhat=1).</span></span></code></pre></div>
<p>We now overlay the estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
versus the actual values. The estimated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
values coincide reasonably with the true values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extract posterior quantiles</span></span>
<span><span class="va">R_draws</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">R_draws</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">middle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">R_draws</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">R_draws</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">epidemic_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    lower <span class="op">=</span> <span class="va">lower</span>,</span>
<span>    middle <span class="op">=</span> <span class="va">middle</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">upper</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">R_t</span>, <span class="va">lower</span>, <span class="va">middle</span>, <span class="va">upper</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">R_t</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">middle</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="fitting_synthetic_data_using_epidp_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ben Lambert, Kris Parag.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
